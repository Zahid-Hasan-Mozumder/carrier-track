// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
  output   = "./client"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

enum FulfillmentStatus {
  IN_TRANSIT
  OUT_FOR_DELIVERY
  DELIVERED
  ATTEMPTED_DELIVERY
  FAILURE
}

model stores {
  id        String   @id @default(uuid())
  shop      String   @unique
  isActive  Boolean? @default(false)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  fulfillments fulfillments[]

  @@index([id])
  @@index([shop])
}

model carriers {
  id          String   @id @default(uuid())
  carrierName String   @unique
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  fulfillments fulfillments[]

  @@index([id])
  @@index([carrierName])
}

model fulfillments {
  id             String            @id @default(uuid())
  fulfillmentId  String            @unique
  orderId        String
  trackingNumber String
  trackingUrl    String
  status         FulfillmentStatus
  createdAt      DateTime          @default(now())
  updatedAt      DateTime          @updatedAt

  storeId   String
  carrierId String

  store   stores   @relation(fields: [storeId], references: [id])
  carrier carriers @relation(fields: [carrierId], references: [id])

  lineItems fulfillmentLineItems[]

  @@index([id])
  @@index([fulfillmentId])
}

model fulfillmentLineItems {
  id            String   @id @default(uuid())
  productId     String
  title         String
  variantId     String
  variantTitle  String?
  sku           String?
  quantity      Int
  grams         Float
  price         String
  totalDiscount String
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt

  fulfillmentId String

  fulfillment fulfillments @relation(fields: [fulfillmentId], references: [id])

  @@index([id])
}

model session {
  id      String  @id
  content String? @db.Text
  shop    String?

  @@index([id])
  @@index([shop])
}

model metrics {
  appLoadId  String   @id
  shop       String?
  INP        Float?
  FID        Float?
  CLS        Float?
  LCP        Float?
  FCP        Float?
  TTFB       Float?
  raw_json   String?  @db.Text
  created_at DateTime @default(now())
}
